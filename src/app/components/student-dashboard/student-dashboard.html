<div class="dashboard">
  <!-- Header Simples -->
  <header class="header">
    <div class="student-info">
      <h1>{{ studentName }}</h1>
      <p>{{ course }}</p>
    </div>
    <button class="logout" (click)="logout()">Sair</button>
  </header>

  <!-- Resumo -->
  <div class="summary">
    <div class="summary-item">
      <span class="label">MÃ©dia Geral:</span>
      <span class="value">{{ averageGrade() }}</span>
    </div>
    <div class="summary-item" *ngIf="totalClassesToRecover() > 0">
      <span class="label">Aulas para Repor:</span>
      <span class="value warning">{{ totalClassesToRecover() }}</span>
    </div>
  </div>

  <!-- BotÃ£o para Solicitar ReposiÃ§Ã£o -->
  <div class="recovery-section" *ngIf="totalClassesToRecover() > 0">
    <button class="recovery-btn" (click)="requestClassRecovery()">
      ðŸ“… Solicitar ReposiÃ§Ã£o de Aulas
    </button>
  </div>

  <!-- SolicitaÃ§Ãµes de ReposiÃ§Ã£o -->
  <div class="requests-section" *ngIf="recoveryRequests.length > 0">
    <h2>ðŸ“‹ Minhas SolicitaÃ§Ãµes de ReposiÃ§Ã£o</h2>
    <div class="requests-list">
      <div class="request-card" 
           *ngFor="let request of recoveryRequests"
           [ngClass]="getRequestStatusClass(request.status)">
        <div class="request-header">
          <div class="request-info">
            <h4>{{ request.subject }}</h4>
            <p>{{ request.professor }}</p>
          </div>
          <div class="request-status">
            <span class="status-badge" [ngClass]="getRequestStatusClass(request.status)">
              {{ getRequestStatusText(request.status) }}
            </span>
          </div>
        </div>
        
        <div class="request-details">
          <div class="detail-item">
            <strong>Aulas para repor:</strong> {{ request.classesToRecover }}
          </div>
          <div class="detail-item">
            <strong>Motivo:</strong> {{ request.reason }}
          </div>
          <div class="detail-item">
            <strong>Data da solicitaÃ§Ã£o:</strong> {{ formatDate(request.requestDate) }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de MatÃ©rias -->
  <div class="subjects">
    <h2>MatÃ©rias</h2>
    <div class="subject-list">
      <div class="subject-item" *ngFor="let subject of subjects">
        <div class="subject-info">
          <div class="subject-name">{{ subject.name }}</div>
          <div class="professor-info">
            <span class="professor-name">{{ subject.professor }}</span>
            <button class="chat-btn" (click)="openChatForSubject(subject.name)">
              ðŸ’¬ Chat
            </button>
          </div>
        </div>
        <div class="subject-details">
          <div class="grade">
            <span class="number">{{ subject.grade }}</span>
            <span class="status" [ngClass]="getStatusClass(subject.grade)">
              {{ getStatus(subject.grade) }}
            </span>
          </div>
          <div class="absences">
            Faltas: {{ subject.absences }}/{{ subject.maxAbsences }}
          </div>
          <div class="recovery" *ngIf="subject.classesToRecover > 0">
            Repor: {{ subject.classesToRecover }} aulas
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de SolicitaÃ§Ã£o de ReposiÃ§Ã£o -->
  <div class="modal-overlay" *ngIf="showRecoveryModal" (click)="closeRecoveryModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ðŸ“… Solicitar ReposiÃ§Ã£o de Aulas</h3>
        <button class="close-btn" (click)="closeRecoveryModal()">âœ•</button>
      </div>
      
      <div class="modal-body" *ngIf="selectedSubject">
        <div class="subject-summary">
          <h4>{{ selectedSubject.name }}</h4>
          <p><strong>Professor:</strong> {{ selectedSubject.professor }}</p>
          <p><strong>Aulas para repor:</strong> {{ selectedSubject.classesToRecover }}</p>
        </div>

        <div class="form-group">
          <label for="recoveryReason">Motivo da solicitaÃ§Ã£o:</label>
          <textarea 
            id="recoveryReason"
            [(ngModel)]="recoveryReason" 
            placeholder="Descreva o motivo pelo qual vocÃª precisa repor estas aulas..."
            class="form-textarea"
            rows="4">
          </textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeRecoveryModal()">Cancelar</button>
        <button class="btn-save" (click)="submitRecoveryRequest()" [disabled]="!recoveryReason.trim()">
          ðŸ“¤ Enviar SolicitaÃ§Ã£o
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de SeleÃ§Ã£o de MatÃ©rias -->
  <div class="modal-overlay" *ngIf="showSubjectSelectionModal" (click)="closeSubjectSelectionModal()">
    <div class="modal selection-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ðŸ“š Escolha a MatÃ©ria para ReposiÃ§Ã£o</h3>
        <button class="close-btn" (click)="closeSubjectSelectionModal()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <p class="selection-instruction">
          VocÃª possui aulas para repor em {{ subjectsNeedingRecovery.length }} 
          {{ subjectsNeedingRecovery.length === 1 ? 'matÃ©ria' : 'matÃ©rias' }}. 
          Clique na matÃ©ria que deseja solicitar a reposiÃ§Ã£o:
        </p>
        
        <div class="subject-selection-list">
          <div class="subject-selection-card" 
               *ngFor="let subject of subjectsNeedingRecovery"
               (click)="selectSubjectForRecovery(subject)">
            <div class="subject-card-header">
              <h4>{{ subject.name }}</h4>
              <span class="classes-badge">{{ subject.classesToRecover }} {{ subject.classesToRecover === 1 ? 'aula' : 'aulas' }}</span>
            </div>
            <div class="subject-card-body">
              <p class="professor-label">
                <strong>Professor(a):</strong> {{ subject.professor }}
              </p>
              <p class="absences-label">
                <strong>Faltas:</strong> {{ subject.absences }}/{{ subject.maxAbsences }}
              </p>
            </div>
            <div class="subject-card-footer">
              <span class="select-arrow">Clique para selecionar â†’</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div class="chat-overlay" *ngIf="showChat" (click)="closeChat()">
    <div class="chat-modal" (click)="$event.stopPropagation()">
      <div class="chat-header">
        <div class="professor-info">
          <span class="professor-avatar">{{ selectedProfessor?.avatar }}</span>
          <div class="professor-details">
            <h3>{{ selectedProfessor?.name }}</h3>
            <p>{{ selectedProfessor?.subject }}</p>
            <span class="online-status" [ngClass]="selectedProfessor?.online ? 'online' : 'offline'">
              {{ selectedProfessor?.online ? 'ðŸŸ¢ Online' : 'ðŸ”´ Offline' }}
            </span>
          </div>
        </div>
        <button class="close-chat" (click)="closeChat()">âœ•</button>
      </div>

      <div class="chat-messages">
        <div class="message" 
             *ngFor="let message of getMessagesForProfessor(selectedProfessor?.id || 0)"
             [ngClass]="message.sender">
          <div class="message-content">
            <p>{{ message.message }}</p>
            <span class="message-time">{{ formatTime(message.timestamp) }}</span>
          </div>
        </div>
      </div>

      <div class="chat-input">
        <input 
          type="text" 
          [(ngModel)]="newMessage" 
          placeholder="Digite sua mensagem..."
          (keyup.enter)="sendMessage()"
          class="message-input">
        <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()">
          Enviar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Sucesso -->
  <div class="modal-overlay success-overlay" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
    <div class="modal success-modal" (click)="$event.stopPropagation()">
      <div class="success-icon">
        <div class="checkmark-circle">
          <div class="checkmark"></div>
        </div>
      </div>
      
      <div class="success-content">
        <h3>{{ successMessage.title }}</h3>
        
        <div class="success-details" *ngIf="successMessage.details.length > 0">
          <div class="detail-row" *ngFor="let detail of successMessage.details">
            <span class="detail-label" *ngIf="detail.label">{{ detail.label }}:</span>
            <span class="detail-value">{{ detail.value }}</span>
          </div>
        </div>
        
        <p class="success-note" *ngIf="successMessage.details.length > 1">
          O coordenador analisarÃ¡ sua solicitaÃ§Ã£o e entrarÃ¡ em contato em breve.
        </p>
      </div>
      
      <div class="success-footer">
        <button class="btn-success-ok" (click)="closeSuccessModal()">
          âœ“ Entendi
        </button>
      </div>
    </div>
  </div>

</div>
